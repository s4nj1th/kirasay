#!/usr/bin/env perl

use strict;
use warnings;
use Getopt::Std;
use Text::Wrap qw(wrap $columns);
use File::Spec;
use List::Util qw(max);

my $VERSION  = "2.0.0";
my $progname = "kirasay";

my %BUILTIN_ARTS = (
    kira     => <<'EOF',
⣿⠖⠀⠀⠀⠀⠀⠙⣿⣿⣷⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⡿⠀⠀⢸⣿⣿⣿⠟⠀⠀⠙⢿⢷⣦⡋⢒⡿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀
⢋⣾⣿⣆⠀⠀⠀⠀⠈⠻⣿⡇⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⣿⡇⠀⠀⣽⣿⡟⠁⠀⠀⠀⠀⠀⠘⢿⣿⣢⣀⣙⡇⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⣿⣿⣿⣤⠄⠀⠀⠀⠀⠛⠇⠀⠀⠀⠀⠀⠀⠈⠿⢿⠟⠀⠀⢸⣿⠋⠀⠀⢀⣴⣿⣿⣦⡀⠀⢻⣿⡤⡀⣷⠀⠀⠀⠀⠀⠀⠀⠀
⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⡿⠁⠀⢀⣴⣿⣿⣿⠿⠋⠉⠉⠈⣿⣿⡟⢸⢀⡾⣦⠀⠀⠀⠀⠀
⣿⣿⣿⣿⣿⣿⣿⣿⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⡇⠀⣠⣿⡿⠛⠉⠀⠀⠈⢻⣿⣇⠀⣿⣿⡸⣾⠠⠘⢷⡄⠀⠀⠀
⣎⢿⣿⣿⣿⣿⣿⣿⣷⣥⣀⡀⠀⠀⠀⠀⠀⠀⣷⣾⣗⢤⡀⡿⠟⠀⣸⡏⣰⡆⠀⠀⠀⠀⠀⣿⡿⢃⣬⣿⣿⣷⢻⡄⠢⠘⣦⠀⠀⠀
⣿⡞⣿⠿⠿⢿⣿⣿⣿⣿⣿⣿⣷⣦⣤⣤⣄⠀⡏⣿⣿⣿⡳⣌⡒⠾⢰⣿⣿⣦⠀⠀⠀⠀⠀⢈⣴⣶⣛⣿⣿⣿⣿⣧⢀⡿⠀⠀⠀⠀
⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠙⠛⠛⠟⠋⢠⣿⢸⣿⣿⣷⣮⣭⣻⣿⣿⣿⢉⣩⣤⣤⣴⣾⠟⠋⠉⣹⣿⢸⣿⣿⣿⡆⣿⡇⠀⠀⠀
⣿⠆⢠⡶⣠⣶⣶⣶⣦⣤⣴⢶⣴⣦⣄⣀⣴⡿⠋⣾⣿⣿⠿⠟⣿⠟⠉⠉⠉⠉⠉⠉⠁⠀⠀⠀⠀⠀⣿⣿⡼⣿⣿⡜⢸⢿⠀⠀⠀⠀
⡻⡆⣐⢰⣿⡿⠿⠛⠋⠀⠀⠀⠀⣶⣶⠍⣿⡿⣈⠴⣿⠉⠀⡈⢄⠉⠱⣤⣄⡀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⡇⣾⣿⡇⢀⣿⠀⠀⠀⠀
⢹⠃⣶⣿⣇⢒⣴⣿⠀⠀⠀⠀⠀⢸⠟⣰⣿⠏⠀⠀⣿⢀⠎⡠⢂⢂⠀⠘⢿⣿⣿⣶⣥⡂⢄⣀⣠⣽⣿⣿⠇⠿⣿⡇⢸⡿⠀⠀⠀⠀
⠜⡜⣿⣿⣦⣜⢿⣿⣦⣀⠀⠀⢀⣴⣾⣿⠋⠀⠀⠀⣿⡟⢠⢳⣥⣷⣷⣶⣌⣿⣿⣿⣿⣿⣷⣬⣟⣿⣿⣿⡏⣿⣿⣶⢻⠀⣷⣄⡀⠀
⡟⢦⡩⣽⣿⣿⣶⣶⣤⣤⣤⣶⣿⡿⠋⠀⠀⠀⠀⢰⣿⡇⣧⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⢻⣿⣿⢰⢸⣿⣿⣧⠀
⢧⢢⠳⡜⣿⣿⣿⣿⡛⡛⠋⠉⠉⠀⠀⠀⠀⠀⠀⢠⣿⣷⣿⣿⣿⣿⡟⠋⣿⡟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⣺⣿⣿⠸⠨⣿⣿⣿⣷
⠘⡎⣵⢱⡹⣿⣿⣿⣿⣎⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠻⠿⠛⠿⣿⠀⠟⢠⣾⣿⣿⣿⣿⣿⣿⣿⡟⠸⣮⣽⣿⣿⡇⠁⢸⣿⣿⣿
⠀⢻⡁⠎⣷⡹⣿⣿⣿⣷⡑⢄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⡿⢋⣴⣿⣟⣿⣿⣿⣧⣟⠁⣾⣿⣿
⠀⠀⠻⣮⡨⠥⣙⢿⣿⣿⣿⣆⢡⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠿⢟⣿⣿⣿⠟⣫⣴⣿⣿⡿⢻⣿⣿⣿⣿⡗⠀⣻⣿⣿
⠀⠀⠀⠈⠙⠿⣷⣦⡻⣿⣿⣿⣷⣝⢆⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣠⣤⣴⣾⡿⠛⢛⣵⣾⣿⣿⠋⣴⡿⣿⣿⣿⡿⡗⠀⢠⡄⠹⣿
⠀⠀⠀⠀⠀⡠⣂⣄⠀⠈⠻⣿⣿⣿⣧⡱⣄⠀⠀⠀⠀⣠⣾⣿⡿⠟⠛⠛⣩⣤⣴⣶⣿⣿⣿⠟⣖⣾⣿⡇⣿⣿⣿⣻⡇⠀⣿⢰⡄⢹
⠀⠀⠀⣠⢞⢕⣿⣟⣥⣀⠀⠈⠻⣿⣿⣿⣄⠄⠀⠠⢤⣤⣤⣶⣿⣿⣿⣿⣿⡿⠟⠛⠉⠁⠀⠠⢿⡟⣿⡿⣿⣿⣿⡇⠀⣻⡇⣿⡇⡈
⠀⣠⡾⣣⢱⢻⠇⠝⣋⣕⣴⡴⡀⠈⠻⣿⣿⣿⣦⠀⠀⠙⠙⠛⠶⠶⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠈⢷⣿⣿⢻⣿⣿⡏⠀⡈⣿⢲⡯⣺
⣴⣿⠟⣌⠱⡯⡅⢸⣯⢬⣽⣕⢓⡐⠀⠈⠻⢿⣿⣷⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⡷⣹⣿⣿⣿⡏⠀⢀⣿⡃⣿⡩
⡿⢡⢺⢨⡢⣼⣇⣧⢥⣭⣊⣾⣎⠡⠘⠄⠀⠀⠉⠻⣿⣿⣷⣦⣀⠀⡀⡄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⢻⡿⠁⣈⢼⣿⠂⣷⠌⣸
⢠⣼⠧⢡⣾⡿⣿⢸⡺⣷⣷⢎⣾⠘⢑⡐⡀⡀⠀⡀⠀⠉⠽⣿⣿⣿⣿⣿⣶⣴⣶⣶⣶⣦⣤⣂⣀⣴⠿⠋⠠⡨⠃⠈⠃⢿⡷⣰⣿⢿
⣾⣿⣥⣭⣾⣸⣿⣦⠈⢎⣛⣣⣿⡧⣠⢈⠀⠨⠀⠢⠠⡀⢀⠀⣑⠨⡋⢟⢛⢿⡻⣿⣿⠿⠟⠛⠉⣤⣤⡧⣐⢄⡐⠀⢠⣐⢹⣿⣿⣿
EOF
    kira2    => <<'EOF',
⠀⣩⣿⣿⣿⣿⣿⣦⠀⠀⠈⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⢀⣿⣿⡇⠀⠀⠀⣠⣿⣿⣦⡀⡈⠙⢴⡭⢀⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿
⡴⠁⠀⠹⣿⣿⣿⣿⣷⣄⠀⢸⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⢸⣿⣿⠂⠀⢠⣾⣿⣿⣿⣿⣿⣧⡀⠀⠝⠿⠦⢸⣿⣿⣿⣿⣿⣿⣿⣿
⠀⠀⠀⠀⠀⠛⣻⣿⣿⣿⣿⣤⣸⣿⣿⣿⣿⣿⣿⣷⣀⡀⣠⣿⣿⡇⠀⣴⣿⣿⡿⠋⠀⠀⠙⢿⣿⡄⠀⢛⢿⠈⣿⣿⣿⣿⣿⣿⣿⣿
⠀⠀⠀⠀⠀⠀⠈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⢀⣾⣿⡿⠋⠀⠀⠀⣀⣴⣶⣶⣷⠀⠀⢠⡇⡿⢁⠙⣿⣿⣿⣿⣿
⠀⠀⠀⠀⠀⠀⠀⠀⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⢸⣿⠟⠀⢀⣤⣶⣿⣿⣷⡄⠀⠸⣿⠀⠀⢇⠁⣟⣧⡈⢻⣿⣿⣿
⠱⡀⠀⠀⠀⠀⠀⠀⠈⠚⠿⢿⣿⣿⣿⣿⣿⣿⠈⠁⠨⡛⢿⢀⣠⣿⠇⢰⠏⢹⣿⣿⣿⣿⣿⠀⢀⡼⠓⠀⠀⠈⡄⢻⣝⣧⠙⣿⣿⣿
⠀⢡⠀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠈⠙⠛⠛⠻⣿⢰⠀⠀⠀⢌⠳⢭⣁⡏⠀⠀⠙⣿⣿⣿⣿⣿⡷⠋⠉⠤⠀⠀⠀⠀⠘⡿⢀⣿⣿⣿⣿
⠀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣦⣤⣤⣠⣴⡟⠀⡇⠀⠀⠈⠑⠒⠄⠀⠀⠀⡶⠖⠛⠛⠋⠁⣠⣴⣶⠆⠀⡇⠀⠀⠀⢹⠀⢸⣿⣿⣿
⠀⣹⡟⢉⠟⠉⠉⠉⠙⠛⠋⡉⠋⠙⠻⠿⠋⢀⣴⠁⠀⠀⣀⣠⠀⣠⣶⣶⣶⣶⣶⣶⣾⣿⣿⣿⣿⣿⠀⠀⢃⠀⠀⢣⡇⡀⣿⣿⣿⣿
⢄⢹⠯⡏⠀⢀⣀⣤⣴⣿⣿⣿⣿⠉⠉⣲⠀⢀⠷⣋⠀⣶⣿⢷⡻⣶⣎⠛⠻⢿⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⢸⠁⠀⢸⡿⠀⣿⣿⣿⣿
⡆⣼⠉⠀⠸⡭⠋⠀⣿⣿⣿⣿⣿⡇⣠⠏⠀⣰⣿⣿⠀⡿⣱⢟⡽⡽⣿⣧⡀⠀⠀⠉⠚⢽⡻⠿⠟⠂⠀⠀⣸⣀⠀⢸⡇⢀⣿⣿⣿⣿
⣣⢣⠀⠀⠙⠣⡀⠀⠙⠿⣿⣿⡿⠋⠁⠀⣴⣿⣿⣿⠀⢠⡟⡌⠚⠈⠈⠉⠳⠀⠀⠀⠀⠀⠈⠓⠠⠀⠀⠀⢰⠀⠀⠉⡄⣿⠈⠻⢿⣿
⢠⡙⢖⠂⠀⠀⠉⠉⠛⠛⠛⠉⠀⢀⣴⣿⣿⣿⣿⡏⠀⢸⠘⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⡄⠀⠀⡏⡇⠀⠀⠘⣿
⡘⡝⣌⢣⠀⠀⠀⠀⢤⢤⣴⣶⣶⣿⣿⣿⣿⣿⣿⡟⠀⠈⠀⠀⠀⠀⢠⣴⠀⢠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠅⠀⠀⣇⣗⠀⠀⠀⠈
⣧⢱⠊⡎⢆⠀⠀⠀⠀⠱⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣦⣄⣀⣤⣀⠀⣿⣠⡟⠁⠀⠀⠀⠀⠀⠀⠀⢠⣇⠑⠂⠀⠀⢸⣾⡇⠀⠀⠀
⣿⡄⢾⣱⠈⢆⠀⠀⠀⠈⢮⡻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⢀⡴⠋⠀⠠⠀⠀⠀⠘⠠⣾⠁⠀⠀
⣿⣿⣄⠑⢗⣚⠦⡀⠀⠀⠀⠹⡞⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣀⡠⠀⠀⠀⣠⠔⠋⠀⠀⢀⡄⠀⠀⠀⠀⢨⣿⠄⠀⠀
⣿⣿⣿⣷⣦⣀⠈⠙⢄⠀⠀⠀⠈⠢⡹⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠟⠛⠋⠁⢀⣤⡤⠊⠁⠀⠀⣴⠋⢀⠀⠀⠀⢀⢨⣿⡟⢻⣆⠀
⣿⣿⣿⣿⣿⢟⠽⠻⣿⣷⣄⠀⠀⠀⠘⢎⠻⣿⣿⣿⣿⠟⠁⠀⢀⣠⣤⣤⠖⠛⠋⠉⠀⠀⠀⣠⠩⠁⠀⢸⠀⠀⠀⠄⢸⣿⠀⡏⢻⡆
⣿⣿⣿⠟⡡⡪⠀⠠⠚⠿⣿⣷⣄⠀⠀⠀⠻⣻⣿⣟⡛⠛⠛⠉⠀⠀⠀⠀⠀⢀⣠⣤⣶⣾⣿⣟⡀⢠⠀⢀⠀⠀⠀⢸⣿⠄⢸⠀⢸⢷
⣿⠟⢁⠜⡎⡄⣸⣢⠴⠪⠋⢋⢿⣷⣄⠀⠀⠀⠙⣿⣿⣦⣦⣤⣉⣉⣀⣴⣾⣿⣿⣿⣿⣿⣿⣿⣷⡈⠀⠀⡄⠀⠀⢰⣿⢷⠀⡍⢐⠅
⠋⠀⣠⠳⣎⢐⢺⡇⠐⡓⠂⠪⡬⢯⣿⣷⣄⡀⠀⠈⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⢈⠆⠀⠀⠀⢰⣿⡿⠀⢼⠀⢖
⢀⡞⡅⡗⢝⠃⠸⠘⡚⠒⠵⠁⠱⣞⣧⣻⣿⣿⣶⣄⠀⠀⠈⠙⠿⣿⢿⢻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⠀⡄⢀⣾⠷⡃⠀⣽⠈⣳⠇
⡟⠃⣘⡞⠁⢀⠀⡇⢅⠈⠈⡱⠁⣧⡮⢯⢿⢿⣿⢿⣿⣶⣂⠀⠀⠀⠀⠀⠉⠋⠉⠉⠉⠙⠛⠽⠿⠋⣀⣴⣟⢗⣼⣷⣼⡀⢈⠏⠀⡀
⠁⠀⠚⠒⠁⠇⠀⠙⣷⡱⠤⠜⠀⢘⠟⡷⣿⣗⣿⣝⣟⢿⡿⣿⠮⣗⢴⡠⡤⡀⢄⠀⠀⣀⣠⣤⣶⠛⠛⢘⠯⡻⢯⣿⡟⠯⡆⠀⠀⠀
EOF
    stand  => <<'EOF',
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠲⢂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⣀⡠⡄⡀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⣧⢇⢂⣠⣤⣤⣴⣤⣤⣄⣀⠊⣁⡿⠀⠠⠜⠜⠐⢻⠀⣃⣥⣌⡿⠦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣀⡾⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⢸⡗⡠⣩⣶⣿⣿⣶⣿⣿⣿⣿⠞⣪⢈⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢸⣇⠉⣉⢙⠛⢿⠛⠛⡿⠛⡛⠿⢧⢫⢰⠟⠛⠻⠿⠻⣏⠸⢋⠤⣶⠆⠉⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠑⣂⠃⠯⢇⢸⣿⣷⠁⠆⠸⢃⣼⢡⢸⣐⡫⠭⠕⢠⣿⣷⢆⠍⠉⢅⣽⡄⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢄⢿⣿⣿⣷⣾⣿⣿⣷⣿⣶⣿⣇⠧⢹⣷⣔⣀⣬⣢⣿⣮⣶⣭⣽⣿⣿⢡⡽⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡐⣿⢺⣿⣿⣿⠿⠛⠛⢿⣿⣿⣿⣸⡤⠜⡙⣿⣿⣿⣿⣄⡛⣱⣿⣿⣿⡟⡼⡇⡼⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⣿⡞⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⡇⢗⠄⡼⣜⣿⣿⣿⢏⣽⠮⢙⣿⣿⣷⡇⢜⠍⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠃⢸⣷⣻⣿⣿⣿⣯⣿⣿⣿⣿⣽⢃⠑⠕⡮⠹⣾⣿⣿⣇⡛⠛⣫⣿⣿⣿⢃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠻⢿⣿⠋⠁⠀⠀⠙⢿⡿⠋⠌⠀⠀⠀⡁⠙⠿⣿⣿⣿⣶⣿⣿⡟⢁⠚⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⣇⣀⠀⠁⢠⣄⣂⠐⡀⢊⢀⡇⠀⠀⠠⠀⠠⠐⠀⠈⠉⠷⠲⠝⠂⢀⣾⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⢠⣤⡶⣶⠥⣴⣘⢌⣿⣦⣄⡈⠉⢠⣾⡟⣼⢇⡀⡀⠁⠀⠀⠀⠀⠄⡀⣄⠀⠄⢠⣿⢃⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣠⣤⣷⣶⣿⣿⣷⣶⣯⢝⡿⣾⣝⠮⣛⢿⠃⠀⣿⣿⡱⢟⡚⠨⠀⠀⠀⠀⠀⠀⠀⢈⠈⠻⠌⠟⠁⣜⡇⢢⡂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⢀⡴⡻⡋⡎⠁⣡⢏⢭⣿⣿⣿⣧⣻⣎⠻⣷⡮⣓⢴⣶⣮⣵⣾⣿⣿⢦⡀⣀⣀⣀⡀⢖⠭⡐⠯⠃⠀⣤⠌⠉⠆⠈⣷⡠⡠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⣨⢋⠕⢁⠴⠶⣋⣷⠃⢔⣽⣿⣿⣿⣾⣿⣆⠝⠮⡻⣾⡭⣾⣿⣿⣿⣿⣌⣁⢻⣿⣿⣿⡌⢃⡪⢨⣂⣀⠠⠩⠀⢀⢠⠘⣷⡝⣷⣥⡀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⢀⢰⠕⠮⢀⠢⠭⠏⠡⢁⡝⣌⣿⣿⡿⣱⣿⢋⣒⣛⡶⣌⠁⣮⡛⢿⣿⣿⣿⣿⣿⢸⣿⣿⠿⣣⢠⢑⡵⢃⠚⠄⢀⣀⠏⣆⢧⢹⣿⣜⣿⣿⣾⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⣧⣅⢖⠀⠁⠒⡃⢜⢹⣽⡿⠿⠏⣼⣿⡏⡾⣿⠞⢙⣀⠒⠛⠛⠒⢛⠋⠙⣿⣿⣮⣭⢄⣾⣿⣧⢣⠚⡭⢏⠤⠀⢉⡈⢹⡉⡆⣿⢿⣮⢿⣿⣷⠹⣷⡤⠀⠀⠀⠀⠀⠀⠀⠀
⠀⡿⣷⣴⣍⣩⣴⢌⡯⠷⠒⣛⣛⡻⠶⣭⡃⠩⠁⠔⡛⠫⠂⠀⠀⠀⠀⠀⠀⣿⣿⣿⠱⣿⣿⣿⣿⣧⢧⠵⣚⠶⠀⠙⣒⠘⣏⢡⡸⣷⣌⢅⣻⣿⢇⡘⣿⡄⡀⠀⠀⠀⠀⠀⠀
⠀⢑⢭⡻⣿⣟⡵⡩⠴⣖⣂⢈⣽⣟⢸⢶⠉⠀⠀⠀⠀⠀⠀⠀⢀⣠⣤⠔⠴⣷⣶⣶⣦⠙⣿⣿⣿⣿⣧⠒⢋⣰⠊⣂⢅⠬⡼⠹⠀⣿⣿⣷⣙⣭⣾⣿⡜⠛⠀⠀⠀⠀⠀⠀⠀
⠀⢠⠀⡅⣴⢋⣴⢾⡏⣯⣭⢷⣭⣭⣟⠋⠀⠀⡁⡢⢀⣴⣤⢖⠀⠀⠀⠀⠀⠙⣿⣿⣿⣷⡘⣿⣿⣿⣿⣷⡙⡆⠆⡑⢀⣀⡁⠠⡿⢸⣿⣿⣿⣿⡿⣿⡇⢁⣶⢠⡀⡀⠀⠀⠀
⠀⠛⡄⢼⠣⣫⣾⢿⡃⣿⢏⣶⡶⡯⢡⠆⢱⠺⣵⠣⠃⠉⠉⠀⢀⣠⡴⠋⢀⡄⢈⢻⣜⢿⣷⣄⠹⣿⣿⣿⣿⣜⢁⡀⠰⠂⠂⠠⠃⠘⣿⣿⢸⡟⠀⢸⡇⣸⣿⢘⣽⣷⠀⠀⠀
⠀⠠⠀⠈⣽⣫⢷⣯⣼⣶⠶⠨⣔⣅⡀⢀⠅⠍⡿⡉⡀⠀⡠⠌⣀⠀⠀⣀⢠⡇⣿⡄⣿⣮⢿⣿⣷⣌⡛⠿⣿⣿⣦⠨⠀⢈⢁⢲⡇⠀⣿⣿⠘⠀⠀⣾⢡⣻⣿⣿⣿⣏⡇⡀⠀
⠀⠀⠁⡀⢕⣵⢟⣭⣦⠀⡈⠶⠛⠁⠀⠈⠀⠈⠈⡠⠁⠈⠚⠏⠀⠀⠈⢀⣾⢳⡧⣿⢈⠿⣜⣿⠙⢿⣿⣦⡀⠉⠻⣷⡍⡐⠈⠐⠄⠀⡿⡟⠑⡀⢀⢛⣨⢭⡻⢿⣿⢸⣿⠆⠀
⠀⠀⠀⠤⢋⣴⣿⣿⣿⠄⣁⠀⠀⠀⢀⢠⠀⠐⡈⠀⠀⠀⠠⠭⢗⣠⢠⣿⣿⣿⡇⣿⡞⣷⡬⠌⡞⣷⣿⣿⣿⣶⡀⠈⠻⣦⠠⠴⠄⠂⣇⠇⢑⡼⣪⣵⣮⡫⣪⠆⢣⣝⠃⠀⠀
⠀⠀⠀⢠⣿⣿⣿⣿⢧⣧⠉⠀⠀⣴⠏⡄⢀⠈⣝⢖⣵⠀⠑⡆⣿⣷⣝⢿⣿⣿⣧⣿⣇⢿⣿⣔⡄⢹⣿⣿⡟⢻⣿⣦⠀⢹⣷⡉⠀⠆⠐⣐⣬⣾⡿⣛⣿⣿⡎⠞⡉⡣⠁⠀⠀
⠀⠀⢘⣼⣿⣿⣿⡿⣼⣿⣷⣀⠲⠀⠁⢈⡈⠀⠠⠟⠁⠋⡀⢂⣿⣿⣿⢹⣿⣿⣿⣿⣿⢸⣿⣿⡄⡀⢿⣿⡇⢸⣿⠘⡀⢈⣛⣣⣴⣾⣿⣿⢟⣭⣾⢿⣿⣿⣷⠋⢱⣷⡂⠀⠀
⠀⠀⠈⢹⣿⣿⡿⢡⣿⣿⣿⡿⣅⢐⣀⠍⣤⠆⠀⠀⣨⣾⡐⣬⡸⣿⡏⣿⣿⣿⢣⣿⣿⡎⣿⣿⣿⠼⣈⠏⣈⣶⣶⣶⣾⣿⣿⣿⣿⢟⣫⣾⣿⣿⠋⢼⣿⡿⠇⣔⣻⣿⣷⡂⠀
⠀⠀⠀⢉⠟⠋⠁⢸⣿⣿⣿⣮⣢⣾⢪⣾⣿⠀⠀⣺⣿⣿⣷⠹⣵⡈⢷⣿⣿⣻⢸⣿⣿⣧⢻⣿⣿⠀⡐⠸⣿⣿⣿⣿⣿⣿⡿⡟⣳⣿⣿⣿⡟⠁⠨⠋⠁⢀⡉⢀⣀⣰⢻⣗⠀
⠀⠀⠀⣸⣇⢾⣷⢸⣿⣿⣿⡽⣛⣵⣿⠟⠁⠀⠐⣿⣿⣿⣿⣷⡹⣿⡀⠉⢟⢃⢸⣿⣿⣿⡸⣿⣿⡄⢇⡆⢹⣿⣿⣿⠟⢋⣴⣾⣿⣿⣿⡿⢀⣥⣶⣿⣿⣿⣿⣿⣆⠬⢭⣗⠀
⠀⠀⠀⠀⠻⣧⣝⠼⠿⠟⠽⢾⡟⠛⠅⠀⢀⠀⢈⠹⣿⣿⣿⣿⣷⡜⢷⡀⠀⠰⢾⠻⣿⣿⣇⠿⠋⣧⣸⣷⢸⣿⠟⣡⢞⣿⣿⣿⣿⡿⢟⣵⣿⣿⣿⣿⣿⣿⡿⡻⣉⣴⣿⡷⠀
⠀⠀⠀⠀⠀⠀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠐⠆⡝⡿⣿⣿⣿⣿⡦⡂⠈⠂⠘⡄⢿⣿⣿⣿⣴⣿⣿⡿⠻⠡⠊⠀⠛⠉⢝⣛⣭⣾⣿⣿⣿⣿⣿⠿⡻⣑⣵⣾⣿⣿⣿⣟⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠡⠀⡨⣵⣿⣿⣿⡇⡇⣿⣦⣄⡀⠄⠈⡻⣿⣿⣿⡿⣋⠔⠁⣐⣠⣬⣶⣾⣿⣿⣿⣿⣿⣿⢟⡫⣑⣵⣾⣿⣿⣿⣿⣿⣿⣯⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡁⠜⠟⠛⠉⢩⠆⢶⢶⢂⡰⡜⡀⣠⣄⣙⠛⠗⠚⣁⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠻⢑⣽⣿⣿⣿⣿⡿⠿⠿⠛⠉⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠁⠀⠀⠀⠈⠨⠔⠿⠽⣮⡷⡭⠂⣿⣿⣿⢇⣴⣿⣿⣿⣿⣿⡿⠟⣋⣩⡤⠰⠋⠁⠀⠀⠀⠚⠉⠉⢀⠠⣄⣤⣤⣶⣿⡯⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⢄⡆⡴⢏⢻⡿⣣⣿⣿⡿⡟⢛⢸⣠⠠⠚⠛⠉⠀⠀⠀⡆⢗⣄⢀⣂⢀⠀⢈⣵⣜⢻⠿⠟⠻⠙⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⡀⠄⠀⠀⠀⠀⠀⢀⣨⡿⣿⡰⠟⣌⢼⣿⣏⠁⠈⠗⠈⠈⠁⣀⣀⣀⣀⣀⠔⠒⡎⠄⢞⢉⢊⢝⠀⢸⣿⣿⣷⣶⣶⣿⣯⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠞⠀⠀⠀⠀⠀⠀⠠⢰⠏⡎⠿⢇⣄⠀⠀⠙⣛⣉⣤⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣃⡆⢀⣎⠅⠊⡘⠀⢸⣿⣿⣿⣿⣿⣿⡷⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠘⠁⠚⠛⠉⠀⠀⠚⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠃⠀⠀⠈⠑⠁⠀⠘⠋⠘⠉⠛⠛⠛⠛⠀
EOF
    stand2 => <<'EOF'
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣍⡽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⠿⢟⢻⢿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣻⠘⡸⡽⠟⠛⠛⠋⠛⠛⠻⠿⣵⠾⢀⣿⣟⣣⣣⣯⡄⣿⠼⠚⠳⢀⣙⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠿⢁⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⡇⢨⢟⠖⠉⠀⠀⠉⠀⠀⠀⠀⣡⠕⡷⣟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⡇⠸⣶⠶⡦⣤⡀⣤⣤⢀⣤⢤⣀⡘⡔⡏⣠⣤⣄⣀⣄⠰⣇⡴⣛⠉⣹⣶⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣮⠽⣼⣐⡸⡇⠀⠈⣾⣹⣇⡼⠃⡞⡇⠯⢔⣒⣪⡟⠀⠈⡹⣲⣶⡺⠂⢻⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡻⡀⠀⠀⠈⠁⠀⠀⠈⠀⠉⠀⠸⣘⡆⠈⠫⠿⠓⠝⠀⠑⠉⠒⠂⠀⠀⡞⢂⣹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢯⠀⡅⠀⠀⠀⣀⣤⣤⡀⠀⠀⠀⠇⢛⣣⢦⠀⠀⠀⠀⠻⢤⠎⠀⠀⠀⢠⢃⢸⢃⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢸⠀⢡⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢸⡨⣻⢃⠣⠀⠀⠀⡰⠂⣑⡦⠀⠀⠈⢸⡣⣲⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣼⡇⠈⠄⠀⠀⠀⠐⠀⠀⠀⠀⠂⡼⣮⣪⢑⣆⠁⠀⠀⠸⢤⣤⠔⠀⠀⠀⡼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣄⡀⠀⣴⣾⣿⣿⣦⡀⢀⣴⣳⣿⣿⣿⢾⣦⣀⠀⠀⠀⠉⠀⠀⢠⡾⣥⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣻⠸⠿⣿⣾⡟⠻⠽⣯⢿⡵⡿⢸⣿⣿⣟⣿⣟⣯⣿⣷⣶⣈⣍⣢⣽⡿⠁⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⡟⠛⢉⠉⣚⠋⠧⡳⠀⠙⠻⢷⣶⡟⠁⢠⠃⡸⢿⢿⣾⣿⣿⣿⣿⣻⢿⠻⣿⣻⡟⠀⡼⡇⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⠟⠛⠈⠉⠀⠀⠈⠉⠐⡢⢀⠁⠢⣑⠤⡀⣼⣿⠀⠀⢎⡠⢥⣗⣿⣿⣿⣿⣿⣿⣿⡷⣷⣄⣳⣠⣾⠣⢸⡝⢽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⡿⢋⢄⢴⢱⣾⠞⡰⡒⠀⠀⠀⠘⠄⠱⣄⠈⢑⠬⡋⠉⠑⠊⠁⠀⠀⡙⢿⠿⠿⠿⢿⡩⣒⢯⣐⣼⣿⠛⣳⣶⣹⣷⠈⢟⢟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⠗⡴⣪⡾⣋⣉⠴⠈⣼⡫⠂⠀⠀⠀⠁⠀⠹⣢⣑⢄⠁⢒⠁⠀⠀⠀⠀⠳⠾⡄⠀⠀⠀⢳⡼⢕⡗⠽⠿⣟⣖⣿⡿⡟⣧⠈⢢⠈⠚⢿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⡿⡏⣪⣑⡿⣝⣒⣰⣞⡾⢢⠳⠀⠀⢀⠎⠀⡴⠭⠤⢉⠳⣾⠑⢤⡀⠀⠀⠀⠀⠀⡇⠀⠀⣀⠜⡟⡮⢊⡼⣥⣻⡿⠿⣰⠹⡘⡆⠀⠣⠀⠀⠁⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⠘⠺⡩⣿⣾⣭⢼⡣⡆⠂⢀⣀⣰⠃⠀⢰⢁⠀⣡⡦⠿⣭⣤⣤⣭⡤⣴⣦⠀⠀⠑⠒⡻⠁⠀⠘⡜⣥⢒⡰⣛⣿⡶⢷⡆⢶⢹⠀⡀⠑⡀⠀⠈⣆⠈⢛⣿⣿⣿⣿⣿⣿⣿⣿
⣿⢀⠈⠋⠲⠖⠋⡳⢐⣈⣭⠤⠤⢄⣉⠒⢼⣖⣾⣫⢤⣔⣽⣿⣿⣿⣿⣿⣿⠀⠀⠀⣎⠀⠀⠀⠀⠘⡘⣊⠥⣉⣿⣦⠭⣧⠰⡞⢇⠈⠳⡺⠄⠀⡸⢧⠀⢻⢿⣿⣿⣿⣿⣿⣿
⣿⡮⡒⢄⠀⠠⢊⢖⣋⠩⠽⡷⠂⠠⡇⡉⣶⣿⣿⣿⣿⣿⣿⣿⡿⠟⠛⣫⣋⠈⠉⠉⠙⣦⠀⠀⠀⠀⠘⣭⡴⠏⣵⠽⡺⣓⢃⣆⣿⠀⠀⠈⠦⠒⠁⠀⢣⣤⣿⣿⣿⣿⣿⣿⣿
⣿⡟⣿⢺⠋⡴⠋⡁⢰⠐⠒⡈⠒⠒⠠⣴⣿⣿⢾⢝⡿⠋⠛⡩⣿⣿⣿⣿⣿⣦⠀⠀⠀⠈⢧⠀⠀⠀⠀⠈⢦⢹⣹⢮⡿⠿⢾⣟⢀⡇⠀⠀⠀⠀⢀⠀⢸⡾⠉⡟⢿⢿⣿⣿⣿
⣿⣤⢻⡃⣜⠔⠁⡀⢼⠀⡰⠉⢉⢐⡞⣹⡎⣅⠊⣜⣼⣶⣶⣿⡿⠟⢋⣴⡿⢻⡷⡄⠣⡀⠈⠻⣆⠀⠀⠀⠀⠣⡾⢿⣏⣽⣽⣟⣼⣧⠀⠀⡇⢠⣿⡇⢸⠇⠀⡧⠂⠈⣿⣿⣿
⣿⣟⣿⣷⠂⠔⡈⠐⠃⠉⣉⣗⠫⠺⢿⡿⣺⣲⢀⢶⢿⣿⢟⣳⠿⣿⣿⠿⡟⢸⠀⢻⠀⠑⡀⠀⠈⠳⢤⣀⠀⠀⠙⣗⣿⡷⡾⡍⢸⣿⠀⠀⣧⣿⣿⠁⡞⠄⠀⠀⠀⠰⢸⢿⣿
⣿⣿⣾⢿⡪⠊⡠⠒⠙⣿⢷⣉⣤⣾⣿⣷⣿⣷⣷⢟⣾⣷⣥⣰⣿⣿⣷⡿⠁⡌⢘⠀⡷⣀⠣⠀⣦⡀⠀⠙⢿⣶⣄⠈⢲⢯⣷⣯⣻⣿⢀⢠⣮⢿⡿⡤⠗⡒⢄⡀⠀⡇⠀⣹⣿
⣿⣿⣿⣛⡴⠋⠀⠀⠀⣻⠾⣿⣿⣿⡿⡟⣿⣯⢷⣿⣿⣿⣟⣒⡨⠟⡟⠀⠀⠀⢸⠀⢡⠈⢓⣳⢡⠈⠀⠀⠀⠉⢿⣷⣄⠙⣟⣋⣻⣽⠸⣸⡮⢃⠕⠊⠑⢔⠕⣹⡜⠢⣼⣿⣿
⣿⣿⣿⡟⠀⠀⠀⠀⡘⠘⣶⣿⣿⠋⣰⢻⡿⣷⠢⡩⠊⣿⣮⢹⠀⠈⠢⡀⠀⠀⠘⠀⠸⡀⠀⠫⢻⡆⠀⠀⢠⡄⠀⠙⣿⡆⠈⢶⣿⣹⣯⠯⠓⠁⢀⠤⠀⠀⢱⣡⢶⢜⣾⣿⣿
⣿⣿⡧⠃⠀⠀⠀⢀⠃⠀⠈⠿⣍⣿⣾⡷⢷⣿⣟⣠⣾⣴⢿⡽⠀⠀⠀⡆⠀⠀⠀⠀⠀⡇⠀⠀⢻⢿⡀⠀⢸⡇⠀⣧⢿⡷⠤⠜⠋⠁⠀⠀⡠⠒⠁⡀⠀⠀⠈⣴⡎⠈⢽⣿⣿
⣿⣿⣷⡆⠀⠀⢀⡞⠀⠀⠀⢀⠺⡯⠿⣲⠛⣹⣿⣿⠗⠁⢯⠓⢇⠀⢰⠀⠀⠀⡜⠀⠀⢱⠀⠀⠀⣃⠷⣰⠷⠉⠉⠉⠁⠀⠀⠀⠀⡠⠔⠁⠀⠀⣴⡃⠀⢀⣸⠫⠄⠀⠈⢽⣿
⣿⣿⣿⡶⣠⣴⣾⡇⠀⠀⠀⠑⠝⠁⡕⠁⠀⣿⣿⠅⠀⠀⠈⣆⠊⢷⡈⠀⠀⠄⡇⠀⠀⠘⡄⠀⠀⣿⢯⣇⠀⠀⠀⠀⠀⠀⢀⢠⠌⠀⠀⠀⢠⣾⣗⣴⣾⡿⢶⡿⠿⠏⡄⠨⣿
⣿⣿⣿⠇⠸⡁⠈⡇⠀⠀⠀⢂⠤⠊⠀⣠⣾⣿⣯⠀⠀⠀⠀⠈⢆⠀⢿⣶⡠⡼⡇⠀⠀⠀⢇⠀⠀⢻⡸⢹⡆⠀⠀⠀⣠⡴⠋⠁⠀⠀⠀⢀⡿⠚⠉⠀⠀⠀⠀⠀⠹⣓⡒⠨⣿
⣿⣿⣿⣿⣄⠘⠢⣃⣀⣠⣂⡁⢠⣤⣺⣿⡿⣿⡷⣆⠀⠀⠀⠀⠈⢣⡈⢿⣿⣏⡁⣄⠀⠀⠸⣀⣴⠘⠇⠈⡇⠀⣠⠞⡡⠀⠀⠀⠀⢀⡠⠊⠀⠀⠀⠀⠀⠀⢀⢄⠶⠋⠀⢈⣿
⣿⣿⣿⣿⣿⣿⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣯⣹⢢⢀⠀⠀⠀⠀⢙⢽⣷⣽⣧⢻⡀⠀⠀⠀⠋⠀⠀⢀⣄⣞⣵⣿⣤⣶⡢⠤⠒⠁⠀⠀⠀⠀⠀⣀⢄⠮⠊⠁⠀⠀⠀⠠⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣞⣿⢗⠊⠀⠀⠀⢸⢸⠀⠙⠻⢿⣻⣷⢄⠀⠀⠀⢀⠴⣫⣾⠯⠟⠓⠉⠁⠀⠀⠀⠀⠀⠀⡠⢔⠮⠊⠁⠀⠀⠀⠀⠀⠀⠐⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢾⣣⣠⣤⣶⡖⣹⡉⡉⡽⢏⢣⢿⠟⠻⠦⣤⣨⣥⠾⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣄⡮⠂⠀⠀⠀⠀⢀⣀⣀⣤⣶⢿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣾⣿⣿⣿⣷⣗⣫⣀⣂⠑⢈⢒⣽⠀⠀⠀⡸⠋⠀⠀⠀⠀⠀⢀⣠⠴⠖⢛⣏⣴⣾⣿⣿⣿⣥⣶⣶⡿⣟⠻⠛⠛⠉⠀⢐⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⡻⢹⢋⡰⡄⢀⠜⠀⠀⢀⢠⡤⡇⠟⣟⣥⣤⣶⣿⣿⣿⢹⡨⠻⡿⠽⡿⣿⡷⠊⠣⡄⣀⣠⣄⣦⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⢿⣻⣿⣿⣿⣿⣿⡿⠗⢀⠀⢏⣠⠳⡃⠀⠰⣾⣷⣨⣷⣷⣾⠿⠿⠿⠿⠿⣫⣭⢱⣻⡡⡶⡵⡢⣿⡇⠀⠀⠈⠉⠉⠀⠐⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣡⣿⣿⣿⣿⣿⣿⣟⡏⣰⢱⣀⡸⠻⣿⣿⣦⠤⠶⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠼⢹⡿⠱⣺⣵⢧⣿⡇⠀⠀⠀⠀⠀⠀⢈⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣧⣾⣥⣤⣶⣿⣿⣥⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣼⣿⣿⣷⣮⣾⣿⣧⣴⣧⣶⣤⣤⣤⣤⣿
EOF
);

my %opts = (
    'W' => 30,
    'a' => 'kira',
    'b' => 'classic',
);

getopts('W:a:b:h', \%opts);

if ($opts{'h'}) {
    print_help();
    exit 0;
}

my $H_PADDING = 2;

my $raw;
if (@ARGV) {
    $raw = join(' ', @ARGV);
} else {
    local $/;
    $raw = join('', <STDIN>);
    chomp $raw;
}

sub trim_spaces {
    my ($s) = @_;
    $s =~ s/^ +//;
    $s =~ s/ +$//;
    return $s;
}

sub collapse_spaces {
    my ($s) = @_;
    $s =~ s/ {2,}/ /g;
    return $s;
}

sub break_long_token {
    my ($token, $limit) = @_;
    return ($token) if length($token) <= $limit;
    my @chunks = unpack("(A$limit)*", $token);
    return @chunks;
}

sub manual_wrap {
    my ($text, $width) = @_;
    $width = int($width) || 40;
    my @out_lines;

    my @paragraphs = split /\n/, $text, -1;

    foreach my $para (@paragraphs) {
        if ($para eq '') {
            push @out_lines, '';
            next;
        }

        my @words = split /\s+/, $para;

        my $line = '';
        foreach my $w (@words) {
            next if $w eq '';
            if (length($w) > $width) {
                if ($line ne '') {
                    push @out_lines, $line;
                    $line = '';
                }
                my @chunks = break_long_token($w, $width);
                for my $c (@chunks) {
                    push @out_lines, $c;
                }
                next;
            }
            if ($line eq '') {
                $line = $w;
            } else {
                if (length($line) + 1 + length($w) > $width) {
                    push @out_lines, $line;
                    $line = $w;
                } else {
                    $line .= ' ' . $w;
                }
            }
        }
        push @out_lines, $line if $line ne '';
    }

    @out_lines = map { collapse_spaces(trim_spaces($_)) } @out_lines;

    return @out_lines;
}

sub bubble_classic_from_lines {
    my (@lines) = @_;
    my $max = @lines ? max(map { length $_ } @lines) : 0;
    my $max2 = $max + 2;

    my @out;
    if (!@lines) {
        return @out;
    } elsif (@lines == 1) {
        push @out, " " . ("_" x $max2);
        push @out, sprintf("< %-${max}s >", $lines[0]);
        push @out, " " . ("-" x $max2);
    } else {
        push @out, " " . ("_" x $max2);
        push @out, sprintf("/ %-${max}s \\", $lines[0]);
        for my $i (1 .. $#lines - 1) {
            push @out, sprintf("| %-${max}s |", $lines[$i]);
        }
        push @out, sprintf("\\ %-${max}s /", $lines[-1]);
        push @out, " " . ("-" x $max2);
    }

    push @out, " " x 4 . "/";
    push @out, " " x 3 . "/";

    return @out;
}

sub bubble_round_from_lines {
    my (@lines) = @_;
    my $max = @lines ? max(map { length $_ } @lines) : 0;

    my @out;
    push @out, " ." . ("-" x ($max )) . ".";
    for my $l (@lines) {
        push @out, sprintf("( %-${max}s )", $l);
    }
    push @out, " '" . ("-" x ($max )) . "'";
    push @out, " " x 4 . "/";
    push @out, " " x 3 . "/";

    return @out;
}

sub bubble_wide_from_lines {
    my (@lines) = @_;
    my $max = @lines ? max(map { length $_ } @lines) : 0;
    my $bar = "-" x ($max + 4);

    my @out;
    push @out, "┌$bar┐";
    for my $l (@lines) {
        push @out, sprintf("│  %-${max}s  │", $l);
    }
    push @out, "└$bar┘";
    push @out, " " x 4 . "/";
    push @out, " " x 3 . "/";

    return @out;
}

sub load_external_arts {
    my $home = $ENV{HOME} || File::HomeDir->my_home;
    my $dir = File::Spec->catdir($home, ".kirasay", "arts");
    my %loaded;
    return %loaded unless -d $dir;
    opendir my $dh, $dir or return %loaded;
    while (my $f = readdir $dh) {
        next unless $f =~ /\.txt$/;
        my $key = $f;
        $key =~ s/\.txt$//;
        my $path = File::Spec->catfile($dir, $f);
        if (open my $fh, '<', $path) {
            local $/;
            $loaded{$key} = <$fh>;
            close $fh;
        }
    }
    closedir $dh;
    return %loaded;
}

sub pick_art {
    my ($key) = @_;
    if (defined $key && -f $key) {
        open my $fh, '<', $key or die "Cannot open art file '$key': $!";
        local $/;
        my $txt = <$fh>;
        close $fh;
        return $txt;
    }
    if (defined $key && exists $BUILTIN_ARTS{$key}) {
        return $BUILTIN_ARTS{$key};
    }
    my %ext = load_external_arts();
    if (defined $key && exists $ext{$key}) {
        return $ext{$key};
    }
    if (%BUILTIN_ARTS) {
        my ($first) = keys %BUILTIN_ARTS;
        return $BUILTIN_ARTS{$first};
    }
    return "";
}

sub print_combined_top_right {
    my ($art_text, $bubble_lines_ref) = @_;
    my @art_lines = $art_text eq '' ? () : split /\n/, $art_text;
    my @bubble = @$bubble_lines_ref;

    my $art_width = @art_lines ? max(map { length $_ } @art_lines) : 0;
    my $max_h = max(scalar @art_lines, scalar @bubble);

    for my $i (0 .. $max_h - 1) {
        my $a = $i < @art_lines ? $art_lines[$i] : "";
        my $b = $i < @bubble ? $bubble[$i] : "";

        if (defined $a) {
            printf "%-${art_width}s", $a;
        } else {
            print ' ' x $art_width;
        }

        if ($b ne '') {
            print ' ' x $H_PADDING;
            print $b;
        }

        print "\n";
    }
}

my @wrapped = manual_wrap($raw, $opts{'W'});

my @bubble_lines;
if ($opts{'b'} eq 'classic') {
    @bubble_lines = bubble_classic_from_lines(@wrapped);
} elsif ($opts{'b'} eq 'round') {
    @bubble_lines = bubble_round_from_lines(@wrapped);
} elsif ($opts{'b'} eq 'wide') {
    @bubble_lines = bubble_wide_from_lines(@wrapped);
} else {
    die "Unknown bubble style '$opts{b}'\n";
}

my $art_text = pick_art($opts{'a'});

print_combined_top_right($art_text, \@bubble_lines);

sub print_help {
    print <<"EOF";
$progname $VERSION

Usage:
    $progname [options] <message>
    echo "text" | $progname

Options:
    -W <n>      Wrap width (default 30)
    -a <name>   ASCII art key (builtin name, external ~/.kirasay/arts/<name>.txt, or file path)
    -b <style>  Bubble style: classic, round, wide
    -h          Help

Notes:
    - Manual cowsay-style wrapping: wraps on whitespace, hard-breaks long tokens.
    - Tabs are treated as separators and not expanded.
    - After wrapping, lines have leading/trailing spaces removed (space chars)
      and internal consecutive spaces collapsed to one.
    - Bubble is printed top-right, flush to the right of the widest art line,
      with $H_PADDING spaces of padding between art and bubble.
    - Fill %BUILTIN_ARTS with your default built-in art(s), or place text files in:
        ~/.kirasay/arts/<name>.txt
EOF
}
